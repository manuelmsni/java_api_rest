<!DOCTYPE html>
<html>
    <head>
        <title>/api-1.0-SNAPSHOT</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>
    <body>
        <script>
            // Función para manejar el envío del formulario
            async function handleLogin(event) {
                event.preventDefault(); // Evita el envío estándar del formulario

                // Obtiene los valores de los campos del formulario
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                // Define los datos a enviar en formato JSON
                const data = {username: username, password: password};

                try {
                    // Realiza la solicitud a la API
                    const response = await fetch('http://localhost:8080/api-1.0-SNAPSHOT/login', {
                        method: 'POST', // Método HTTP
                        headers: {
                            'Content-Type': 'application/json', // Indica el tipo de contenido que se está enviando
                        },
                        body: JSON.stringify(data), // Convierte los datos a una cadena JSON
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    // Procesa la respuesta JSON, que se espera contenga el JWT
                    const {jwt} = await response.json();

                    // Aquí puedes usar el JWT como necesites, por ejemplo, guardarlo en localStorage
                    console.log('JWT recibido:', jwt);
                    localStorage.setItem('jwt', jwt);
                } catch (error) {
                    console.error('Error al realizar la solicitud:', error);
                }
            }
            async function fetchWithJWT(url, method = 'GET', body = null) {
                const jwt = localStorage.getItem('jwt'); // Obtiene el JWT almacenado

                // Prepara las opciones de la solicitud
                const options = {
                    method: method,
                    headers: {
                        'Authorization': `Bearer ${jwt}`, // Usa el JWT en la cabecera Authorization
                        'Content-Type': 'application/json',
                    },
                };

                // Añade el cuerpo a la solicitud si es necesario y no es una solicitud GET
                if (body && method !== 'GET') {
                    options.body = JSON.stringify(body);
                }

                try {
                    const response = await fetch(url, options);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    // Supone que la respuesta es JSON; ajusta según sea necesario
                    return await response.json();
                } catch (error) {
                    console.error('Error al realizar la solicitud:', error);
                    throw error; // O maneja el error según lo necesites
                }
            }
        </script>
        <form onsubmit="handleLogin(event)">
            <div>
                <label for="username">Nombre de usuario:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div>
                <label for="password">Contraseña:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <div>
                <button type="submit">Iniciar Sesión</button>
            </div>
        </form>
        <h1>Documentación</h1>
        <p>Turorial de creación del proyecto: <a href="https://www.youtube.com/watch?v=r_CGbP9kYbc">[Enlace]</a></p>
        <p>Comando crear imagen docker: docker build -t api-1.0-snapshot .</p>
        <p></p>
    </body>
</html>
